---
title: "MN COVID-19 Cases"
author: "Kyle E. Chambers (kchamber@gustavus.edu)"
date: "3/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(janitor)
library(here)

theme_set(theme_minimal())
```

```{r}
all_confirmed <- 
  read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv") %>%
  clean_names() %>% 
  filter(province_state %in% c("Minnesota", "Virginia", "Oklahoma")) %>% 
  add_column("measure" = "confirmed")

all_recovered <- 
  read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Recovered.csv") %>%
  clean_names() %>% 
  filter(province_state %in% c("Minnesota", "Virginia", "Oklahoma")) %>% 
  add_column("measure" = "recovered")

all_deaths <- 
  read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Deaths.csv") %>%
  clean_names() %>% 
  filter(province_state %in% c("Minnesota", "Virginia", "Oklahoma")) %>% 
  add_column("measure" = "deaths")

all_cases <- 
  bind_rows(all_confirmed, all_deaths, all_recovered) %>% 
  select(measure, "state" = province_state, everything(), -country_region, -lat, -long)

all_cases_long <-
  all_cases %>% 
  pivot_longer(names_to = "date", values_to = "cases", c(-measure, -state)) %>% 
  mutate(date = str_remove(date, "x")) %>% 
  mutate(date = mdy(date)) %>% 
  group_by(measure) %>% 
  mutate(new_cases = cases - lag(cases, 1)) %>% 
  ungroup() %>% 
  filter(date >= "2020-03-01")

```


```{r}

ggplot(all_cases_long, aes(x = date, y = new_cases, color = measure, fill = measure)) +
  geom_col() +
  facet_wrap(~state)

```

